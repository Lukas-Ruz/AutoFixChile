{% load static %}
<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Registro de Vehículo</title>
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="{% static "style.css" %}" />
  </head>
  <body>
    <!-- Barra de navegacion principal -->
    <div class="container-fluid" style="background-color: rgb(144, 144, 179)">
      <ul class="nav">
        <a class="link" href="{% url "Inicio" %}">
          <img src="{% static "img/logo.png" %}" height="40" alt="logo" style="margin: 5px"
        /></a>
        <a
          class="link"
          href="{% url "Inicio" %}"
          style="color: black; text-decoration: none"
        >
          <h1 class="title">
            <strong> AutoFixChile </strong>
          </h1></a
        >
        <li class="nav-item">
          <a
            class="nav-link active"
            aria-current="page"
            href="{% url "Servicios" %}"
            style="margin: 5px; color: black"
            >Nuestros servicios</a
          >
        </li>
        <li class="nav-item">
          <a
            class="nav-link active"
            aria-current="page"
            href="{% url "Contacto" %}"
            style="margin: 5px; color: black"
            >Contactos</a
          >
        </li>
        <li class="nav-item">
          <a
            class="nav-link active"
            aria-current="page"
            href="../usuario/perfil.html"
            style="margin: 5px; color: black"
            >Perfil</a
          >
        </li>
      </ul>
      <form class="nav justify-content-end" role="button">
        <a href="../usuario/iniciarsesion.html">
          <button
            type="button"
            class="btn btn-light"
            style="
              border-color: black;
              border-radius: 30px;
              margin: 5px;
              text-align: center;
            "
          >
            Iniciar Sesion
          </button>
        </a>
        <a href="../usuario/registro.html">
          <button
            type="button"
            class="btn btn-light"
            style="
              border-color: black;
              border-radius: 30px;
              margin: 5px;
              text-align: center;
            "
          >
            Registrar
          </button>
        </a>
      </form>
    </div>
    <!-- Fromulario ingreso vehiculo -->
    <div
      class="container mt-5"
      style="
        background-color: white;
        border-radius: 5px;
        height: 50rem;
        max-width: 600px;
      "
    >
      <h2 style="text-align: center">Registrar Vehículo</h2>
      <form id="vehiculoForm" novalidate>
        <div class="mb-3">
          <label for="patente" class="form-label">Patente</label>
          <input
            type="text"
            class="form-control"
            id="patente"
            name="patente"
            required
          />
          <div class="invalid-feedback">Por favor ingresa la patente.</div>
        </div>
        <div class="mb-3">
          <label for="marca" class="form-label">Marca</label>
          <input
            type="text"
            class="form-control"
            id="marca"
            name="marca"
            required
          />
          <div class="invalid-feedback">Por favor ingresa la marca.</div>
        </div>
        <div class="mb-3">
          <label for="modelo" class="form-label">Modelo</label>
          <input
            type="text"
            class="form-control"
            id="modelo"
            name="modelo"
            required
          />
          <div class="invalid-feedback">Por favor ingresa el modelo.</div>
        </div>
        <div class="mb-3">
          <label for="fechaEncargo" class="form-label">Fecha Encargo</label>
          <input
            type="date"
            class="form-control"
            id="fechaEncargo"
            name="fechaEncargo"
            required
          />
          <div class="invalid-feedback">
            Por favor ingresa la fecha de encargo.
          </div>
        </div>
        <div class="mb-3">
          <label for="runResponsable" class="form-label">RUN Responsable</label>
          <input
            type="text"
            class="form-control"
            id="runResponsable"
            name="runResponsable"
            placeholder="00000000-0"
            required
          />
          <div class="invalid-feedback">
            Formato RUN inválido. Debe ser 00000000-0.
          </div>
        </div>
        <div class="mb-3">
          <label for="nombreResponsable" class="form-label"
            >Nombre Responsable</label
          >
          <input
            type="text"
            class="form-control"
            id="nombreResponsable"
            name="nombreResponsable"
            required
          />
          <div class="invalid-feedback">
            Por favor ingresa el nombre del responsable.
          </div>
        </div>
        <div class="mb-3">
          <label class="form-label"
            >areas de trabajo (selecciona hasta 4)</label
          >
          <div class="form-check">
            <input
              class="form-check-input area-checkbox"
              type="checkbox"
              value="Carroceria"
              id="areaCarroceria"
            />
            <label class="form-check-label" for="areaCarroceria"
              >Carrocería</label
            >
          </div>
          <div class="form-check">
            <input
              class="form-check-input area-checkbox"
              type="checkbox"
              value="Mecanica"
              id="areaMecanica"
            />
            <label class="form-check-label" for="areaMecanica">Mecánica</label>
          </div>
          <div class="form-check">
            <input
              class="form-check-input area-checkbox"
              type="checkbox"
              value="Electronica"
              id="areaElectronica"
            />
            <label class="form-check-label" for="areaElectronica"
              >Electrónica</label
            >
          </div>
          <div class="form-check">
            <input
              class="form-check-input area-checkbox"
              type="checkbox"
              value="Pintura"
              id="areaPintura"
            />
            <label class="form-check-label" for="areaPintura">Pintura</label>
          </div>
          <div
            class="invalid-feedback d-block"
            id="areasError"
            style="display: none"
          >
            Debes seleccionar al menos una área y máximo cuatro.
          </div>
        </div>
        <button type="submit" class="btn btn-primary">
          Registrar Vehículo
        </button>
      </form>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      $(document).ready(function () {
        // Checkboxes
        $(".area-checkbox").on("change", function () {
          const checkedCount = $(".area-checkbox:checked").length;
          if (checkedCount > 4) {
            this.checked = false;
            alert("Solo puedes seleccionar hasta 4 áreas.");
          }
          $("#areasError").hide();
        });

        $("#vehiculoForm").on("submit", function (e) {
          e.preventDefault();

          // Limpiar validaciones previas
          $("#vehiculoForm input").removeClass("is-invalid");
          $("#areasError").hide();

          let valido = true;

          if (!$("#patente").val().trim()) {
            $("#patente").addClass("is-invalid");
            valido = false;
          }
          if (!$("#marca").val().trim()) {
            $("#marca").addClass("is-invalid");
            valido = false;
          }
          if (!$("#modelo").val().trim()) {
            $("#modelo").addClass("is-invalid");
            valido = false;
          }
          if (!$("#fechaEncargo").val()) {
            $("#fechaEncargo").addClass("is-invalid");
            valido = false;
          }
          const runVal = $("#runResponsable").val().trim();
          const runRegex = /^\d{7,8}-[0-9kK]$/;
          if (!runRegex.test(runVal)) {
            $("#runResponsable").addClass("is-invalid");
            valido = false;
          }
          if (!$("#nombreResponsable").val().trim()) {
            $("#nombreResponsable").addClass("is-invalid");
            valido = false;
          }

          const areasSeleccionadas = $(".area-checkbox:checked")
            .map(function () {
              return this.value;
            })
            .get();

          if (
            areasSeleccionadas.length === 0 ||
            areasSeleccionadas.length > 4
          ) {
            $("#areasError").show();
            valido = false;
          }

          if (valido) {
            alert(
              "Vehículo registrado correctamente!\n\n" +
                "Patente: " +
                $("#patente").val().trim() +
                "\n" +
                "Marca: " +
                $("#marca").val().trim() +
                "\n" +
                "Modelo: " +
                $("#modelo").val().trim() +
                "\n" +
                "Fecha Encargo: " +
                $("#fechaEncargo").val() +
                "\n" +
                "RUN Responsable: " +
                runVal +
                "\n" +
                "Nombre Responsable: " +
                $("#nombreResponsable").val().trim() +
                "\n" +
                "Áreas: " +
                areasSeleccionadas.join(", ")
            );
            this.reset();
            this.submit;
            window.location.href = "../index.html";
          }
        });
      });
    </script>
  </body>
</html>
