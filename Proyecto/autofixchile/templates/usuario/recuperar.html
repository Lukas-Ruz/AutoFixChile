{% load static %}
<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Recuperar Contraseña</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../style.css" />
  </head>
  <body>
    <!-- Barra de navegacion principal -->
    <div class="container-fluid" style="background-color: rgb(144, 144, 179)">
      <ul class="nav">
        <a class="link" href="{% url "Inicio" %}">
          <img src="{% static "img/logo.png" %}" height="40" alt="logo" style="margin: 5px"
        /></a>
        <a
          class="link"
          href="{% url "Inicio" %}"
          style="color: black; text-decoration: none"
        >
          <h1 class="title">
            <strong> AutoFixChile </strong>
          </h1></a
        >
        <li class="nav-item">
          <a
            class="nav-link active"
            aria-current="page"
            href="{% url "Servicios" %}"
            style="margin: 5px; color: black"
            >Nuestros servicios</a
          >
        </li>
        <li class="nav-item">
          <a
            class="nav-link active"
            aria-current="page"
            href="{% url "Contacto" %}"
            style="margin: 5px; color: black"
            >Contactos</a
          >
        </li>
        <li class="nav-item">
          <a
            class="nav-link active"
            aria-current="page"
            href="{% url "Perfil" %}"
            style="margin: 5px; color: black"
            >Perfil</a
          >
        </li>
      </ul>
      <form class="nav justify-content-end" role="button">
        <a href="{% url "Login" %}">
          <button
            type="button"
            class="btn btn-light"
            style="
              border-color: black;
              border-radius: 30px;
              margin: 5px;
              text-align: center;
            "
          >
            Iniciar Sesion
          </button>
        </a>
        <a href="{% url "Registro" %}">
          <button
            type="button"
            class="btn btn-light"
            style="
              border-color: black;
              border-radius: 30px;
              margin: 5px;
              text-align: center;
            "
          >
            Registrar
          </button>
        </a>
      </form>
    </div>
    <div
      class="container mt-5"
      style="
        background-color: white;
        border-radius: 5px;
        height: 50rem;
        max-width: 600px;
      "
    >
      <h2 style="text-align: center">Recuperar Contraseña</h2>
      <form id="recuperarForm" novalidate>
        <div class="mb-3">
          <label for="runRecuperar" class="form-label">RUN</label>
          <input
            type="text"
            class="form-control"
            id="runRecuperar"
            name="runRecuperar"
            placeholder="12345678-9"
            required
          />
          <div class="invalid-feedback">Formato RUN inválido (12345678-9)</div>
        </div>
        <div class="mb-3">
          <label for="nombreRecuperar" class="form-label">Nombre</label>
          <input
            type="text"
            class="form-control"
            id="nombreRecuperar"
            name="nombreRecuperar"
            required
          />
          <div class="invalid-feedback">Por favor ingrese su nombre.</div>
        </div>
        <div class="mb-3">
          <label for="nuevaContraseña" class="form-label"
            >Nueva Contraseña</label
          >
          <input
            type="text"
            class="form-control"
            id="nuevaContraseña"
            name="nuevaContraseña"
            required
          />
          <div class="invalid-feedback">
            La contraseña debe tener al menos 8 caracteres, una mayúscula, un
            número y un caracter especial.
          </div>
        </div>
        <div class="mb-3">
          <label for="nuevaContraseña2" class="form-label"
            >Repetir Nueva Contraseña</label
          >
          <input
            type="text"
            class="form-control"
            id="nuevaContraseña2"
            name="nuevaContraseña2"
            required
          />
          <div class="invalid-feedback">Las contraseñas no coinciden.</div>
        </div>
        <button type="submit" class="btn btn-primary">
          Recuperar Contraseña
        </button>
      </form>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      $(document).ready(function () {
        $("#recuperarForm").on("submit", function (e) {
          e.preventDefault();

          // Limpiar estados previos
          $("input").removeClass("is-invalid");

          let valido = true;

          // Validar RUN
          const runVal = $("#runRecuperar").val().trim();
          const runRegex = /^\d{7,8}-[0-9kK]$/;
          if (!runRegex.test(runVal)) {
            $("#runRecuperar").addClass("is-invalid");
            valido = false;
          }

          // Validar nombre
          if (!$("#nombreRecuperar").val().trim()) {
            $("#nombreRecuperar").addClass("is-invalid");
            valido = false;
          }

          // Validar nueva contraseña
          const nuevaContraseña = $("#nuevaContraseña").val();
          const passwordRegex =
            /^(?=.*[A-Z])(?=.*\d)(?=.*[!@#$%^&*()_\-+={}[\$|\\:;"'<>,.?/~`]).{8,}$/;
          if (!passwordRegex.test(nuevaContraseña)) {
            $("#nuevaPassword").addClass("is-invalid");
            valido = false;
          }

          const nuevaContraseña2 = $("#nuevaContraseña2").val();
          if (nuevaContraseña !== nuevaContraseña2 || !nuevaContraseña2) {
            $("#nuevaContraseña2").addClass("is-invalid");
            valido = false;
          }

          if (valido) {
            alert("Contraseña recuperada de forma exitosa");
            this.submit;
            window.location.href = "../index.html";
          }
        });
      });
    </script>
  </body>
</html>
